<!DOCTYPE html>
<html>
<head>
  <%block name="title"><title>MITx 6.002</title></%block>

  <!--link rel="stylesheet" href="${ settings.LIB_URL }jquery.treeview.css" type="text/css" media="all" /-->
  <link rel="stylesheet" href="/static/css/marketing.css" type="text/css" media="all" />
  <!--[if lt IE 8]>
  <link rel="stylesheet" href="/static/css/marketing-ie.css" type="text/css" media="all" />
  <![endif]-->

  <script type="text/javascript" src="${ settings.LIB_URL }jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="${ settings.LIB_URL }jquery-ui-1.8.16.custom.min.js"></script>

  <script type="text/javascript" src="/static/js/jquery.leanModal.min.js"></script>
  <!--script type="text/javascript" src="${ settings.LIB_URL }swfobject/swfobject.js"></script-->
  <!--script type="text/javascript" src="${ settings.LIB_URL }jquery.treeview.js"></script-->
  <!--script type="text/javascript" src="/static/js/video_player.js"></script-->
  <!-- <script type="text/javascript" src="/static/js/schematic.js"></script> -->

  <!--[if lt IE 9]>
  <script src="/static/js/html5shiv.js"></script>
  <![endif]-->

  <script type="text/javascript">
    $(function(){
      $("a[rel*=leanModal]").leanModal();
    });
  </script>

<%block name="headextra"/>

<script type="text/javascript">
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
	var cookies = document.cookie.split(';');
	for (var i = 0; i < cookies.length; i++) {
	    var cookie = jQuery.trim(cookies[i]);
	    // Does this cookie string begin with the name we want?
	    if (cookie.substring(0, name.length + 1) == (name + '=')) {
		cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		break;
	    }
	}
    }
    return cookieValue;
}

function postJSON(url, data, callback) {
    $.ajax({type:'POST',
	    url: url,
		dataType: 'json',
		data: data,
		success: callback,
		headers : {'X-CSRFToken':getCookie('csrftoken')}
  });
}
</script>

</head>

<body>
  <%block name="header">
  <header class="announcement <%block name="header_class"/>">
    <div class="anouncement-wrapper">
    <%block name="header_nav">
    <nav>
      <h1><a href="http://mitx.mit.edu/">MITx</a></h1>
% if settings.COURSEWARE_ENABLED:
      <a rel="leanModal" class="login" href="#login">Log In</a>
% endif
    </nav>
    </%block>

    <%block name="header_text">
      <section>
        <h1><em>MITx</em></h1>
        <h2>MIT&rsquo;s new online learning initiative</h2>
      </section>
     </%block>
    </div>
  </header>
  </%block>

  ${self.body()}
  <%block name="bodyextra"/>

  <footer>
    <div class="footer-wrapper">
      <p> Copyright &copy; 2012. MIT. <a href="/t/copyright.html">Some rights reserved.</a></p>

      <ul>
        <li><a href="/t/tos.html">Terms of Service</a></li>
        <li><a href="/t/privacy.html">Privacy Policy</a></li>
        <li><a href="/t/honor.html">Honor Code</a></li>
      </ul>
    </div>
  </footer>

% if settings.COURSEWARE_ENABLED:
  <div id="login" class="leanModal_box"><%include file="login.html" /></div>
% endif
  <div id="pwd_reset" class="leanModal_box"><%include file="password_reset_form.html" /></div>
  <div id="reset_done" class="leanModal_box"></div>

<script>
$(document).ready(function(){
    /* Handles when the user tries to log in. Grabs form data. Does AJAX.
       Either shows error, or redirects. */
  $('form#login_form').submit(function(e) {
    e.preventDefault();
    var submit_data={};
    $.each($("[id^=li_]"), function(index,value){
      submit_data[value.name]=value.value;
    });
    submit_data["remember"] = ($('#remember').attr("checked")? true : false);

    postJSON('/login',
      submit_data,
      function(json) {
        if(json.success) {
          location.href="/courseware";
        } else if($('#login_error').length == 0) {
        $('#login_form').prepend('<div id="login_error">Email or password is incorrect.</div>');
        } else {
          $('#login_error').stop().css("background-color", "#933").animate({ backgroundColor: "#333"}, 2000);
        }
      }
    );
  });


  $('form#pwd_reset_form').submit(function(e) {
    e.preventDefault();
    var submit_data = {};
    submit_data['email'] = $('#id_email').val();
    postJSON('/password_reset/',
      submit_data,
      function(json){
        if (json.success) {
          $('#pwd_reset').html(json.value);
        } else {
          $('#pwd_error').html(json.error).stop().css("background-color", "#933").animate({ backgroundColor: "#333"}, 2000);
        }
      }
    );
  });

});
</script>

</body>
</html>
