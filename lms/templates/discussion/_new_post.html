<%def name="render_form_filter_dropdown(map)">
    % for child in map["children"]:
        % if child in map["entries"]:
            ${render_entry(map["entries"], child)}
        %else:
            ${render_category(map["subcategories"], child)}
        %endif
    %endfor
</%def>

<%def name="render_entry(entries, entry)">
    <li><a href="#" data-discussion_id="${entries[entry]}">${entry}</a></li>
</%def>

<%def name="render_category(categories, category)">
    <li>
        <a href="#">${category}</a>
        <ul>
            ${render_form_filter_dropdown(categories[category])}
        </ul>
    </li>
</%def>

<article class="new-post-article">
    <div class="inner-wrapper">
        <form class="new-post-form">
            <div class="left-column">
                <label>Create new post in:</label>
                <div class="form-topic-drop">
                    <a href="#" class="form-topic-drop-btn">Homework / Week 1 <span class="drop-arrow">▾</span></a>
                    <div class="form-topic-drop-menu-wrapper">
                        <div class="form-topic-drop-search">
                            <input type="text" class="form-topic-drop-search-input" placeholder="filter topics">
                        </div>
                        <ul class="form-topic-drop-menu">
                            ${render_form_filter_dropdown(category_map)}
                        </ul>
                    </div>
                </div>
                <div class="options">
                    <input type="checkbox" name="follow" class="discussion-anonymous" class="discussion-follow" id="new-post-follow" checked><label for="new-post-follow">follow this post</label>
                    <br>
                    <input type="checkbox" name="follow" class="discussion-follow" id="new-post-anonymous" checked><label for="new-post-anonymous">post anonymously</label>
                </div>
            </div>
            <div class="right-column">
                <div class="form-row">
                    <input type="text" class="new-post-title" name="title" placeholder="Title">
                </div>
                <div class="form-row">
                    <textarea class="new-post-body" name="body" placeholder="Enter your question or comment…"></textarea>
                    <div class="new-post-preview"><span class="new-post-preview-label">Preview</span></div>
                </div>
                <div class="form-row">
                    <input type="text" class="new-post-tags" name="tags" placeholder="Tags">
                </div>
                <input type="submit" class="submit" value="Add post">
                <a href="#" class="new-post-cancel">Cancel</a>
            </div>
        </form>
    </div>
</article>
