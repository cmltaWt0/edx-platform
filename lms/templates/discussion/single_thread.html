<%! import django_comment_client.helpers as helpers %>
<%! from django.template.defaultfilters import escapejs %>
<%inherit file="../main.html" />
<%namespace name='static' file='../static_content.html'/>
<%block name="bodyclass">discussion</%block>
<%block name="title"><title>Discussion – ${course.number}</title></%block>

<%block name="headextra">
<%static:css group='course'/>
<%include file="_js_head_dependencies.html" />
</%block>

<%block name="js_extra">
<%include file="_js_body_dependencies.html" />
<%static:js group='discussion'/>
</%block>

<%include file="../courseware/course_navigation.html" args="active_page='discussion'" />

<div class="">
  <a href="#" class="new-post-btn"><span class="new-post-icon"></span>New Post</a>
</div>

<div class="discussion container">
  <div class="discussion-body">
    <div class="sidebar">
      <div class="browse-search">
        <div class="browse is-open">
          <a href="#" class="board-drop-icon"></a>
          <a href="#" class="board-drop-btn"><span class="current-board">Homework / Week 1</span> <span class="drop-arrow">▾</span></a>
        </div>            
        <ul class="board-drop-menu">
          <li><a href="#"><span class="board-name">All</span> <span class="unread">1,248</span></a></li>
          <li><a href="#"><span class="board-name">Following</span></a></li>
          <li><a href="#"><span class="board-name">General</span> <span class="unread">124</span></a></li>
          <li>
            <a href="#"><span class="board-name">Homework</span> <span class="unread">27</span></a>
            <ul>
              <li><a href="#"><span class="board-name">Week 1</span> <span class="unread">24</span></a></li>
              <li>
                <a href="#"><span class="board-name">Week 2</span> <span class="unread">27</span></a>
                <ul>
                  <li><a href="#"><span class="board-name">Problem 1</span> <span class="unread">14</span></a></li>
                  <li><a href="#"><span class="board-name">Problem 2</span> <span class="unread">13</span></a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        <div class="search">
          <form class="post-search">
            <input type="text" placeholder="Search all discussions" class="post-search-field">
          </form>
        </div>
      </div>
      <div class="sort-bar">
        <span class="sort-label">Sort by:</span>
        <ul>
          <li><a href="#" class="active" data-sort="date">date</a></li>
          <li><a href="#" data-sort="votes">votes</a></li>
          <li><a href="#" data-sort="comments">comments</a></li>
        </ul>
      </div>
      <div class="post-list-wrapper">
        <ul class="post-list">
        </ul>
      </div>
    </div>

    <div class="discussion-column">      

      ${content.decode('utf-8')}

    </div>
  </div>
</div>

<script type="text/template" id="thread-list-item-template">
    <a href="#"><span class="title">${"<%= title %>"}</span> <span class="comments-count">${"<%= comments_count %>"}</span><span class="votes-count">+${"<%= votes['up_count'] %>"}</span></a>
</script>

<script>
    $$contents = {}
    $$discussions = {}
    $(document).ready(function() {
        var user = new DiscussionUser(JSON.parse("${annotated_content_info | escapejs}"));
        var discussion = new Discussion(JSON.parse("${threads | escapejs}"));

        list_view = new DiscussionThreadListView({collection: discussion, el: $(".post-list")});
        list_view.render();

        var thread = discussion.get("${thread_id | escapejs}")
        view = new DiscussionThreadView({el: $(".discussion-article"), model: thread, user: user});
        view.render();
    });
</script>
