<%! from django.core.urlresolvers import reverse %>

<%
def url_for(thread_id):
  return reverse('django_comment_client.forum.views.single_thread', args=[thread_id])
%>



<section class="discussion">
  <div class="discussion-non-content">
    <a class="discussion-title" href="javascript:void(0)">Discussion</a>
    ${search_bar}
    <form class="new-post-form" _id="${discussion_id}">
      <input type="text" class="new-post-title" placeholder="Title"/>
      <textarea class="new-post-body"></textarea>
      <a class="discussion-new-post" href="javascript:void(0)">New Post</a>
    </form>
  </div>
  % for thread in threads:
    ${render_thread(thread)}
  % endfor
</section>

<%def name="render_thread(thread, edit_thread=False, show_comments=False)">
  <div class="thread" _id="${thread['id']}">
    <div class="discussion-content">
      <a class="thread-title" name="${thread['id']}" href="${url_for(thread['id'])}">${thread['title']}</a>
      <div class="discussion-content-view">
        <div class="thread-body">${thread['body']}</div>
        <div class="info">
          ${render_info(thread)}
          % if edit_thread:
            ${render_reply('')}
            ${render_edit('')}
          % endif
        </div>
      </div>
    </div>
    % if show_comments:
      <div class="comments">
        ${render_comments(thread['children'])}
      </div>
    % endif
  </div>
</%def>

<%def name="render_comments(comments)">
  % for comment in comments:
    <div class="comment" _id="${comment['id']}">
      <div class="discussion-content">
        <div class="discussion-content-view">
          <a class="comment-body" name="${comment['id']}">${comment['body']}</a>
          <div class="info">
            ${render_info(comment)}
            ${render_reply('')}
            ${render_edit('')}
          </div>
        </div>
      </div>
      <div class="comments">
        ${render_comments(comment['children'])}
      </div>
    </div>
  % endfor
</%def>

<%def name="render_info(content)">
  ${time_ago_in_words(parse(content['updated_at']))} ago by user No.${content['user_id']}
</%def>

<%def name="render_reply(url)">
  <a class="discussion-link discussion-reply" href="javascript:void(0)">Reply</a>
</%def>

<%def name="render_edit(url)">
  <a class="discussion-link discussion-edit" href="javascript:void(0)">Edit</a>
</%def>
