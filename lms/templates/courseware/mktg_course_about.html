<%!
  from django.core.urlresolvers import reverse
  from courseware.courses import course_image_url, get_course_about_section
  from courseware.access import has_access
%>
<%namespace name='static' file='../static_content.html'/>

<%inherit file="../mktg_iframe.html" />

<%block name="headextra">
  <%include file="../google_analytics.html" />
</%block>

<%block name="js_extra">

  % if not registered:
    %if user.is_authenticated():
      ## If the user is authenticated, clicking the enroll button just submits a form
      <script type="text/javascript">
      (function() {
        $(".register").click(function() {
          $("#class_enroll_form").submit();
        });

        $(document).delegate('#class_enroll_form', 'ajax:success', function(data, json, xhr) {
          if(json.success) {
            location.href="${reverse('dashboard')}";
          }else{
          $('#register_message').html('<p class="inline-error">' + json.error + "</p>");
          }
        });
      })(this)
      </script>
    %else:
      ## If the user is not authenticated, clicking the enroll button pops up the register
      ## field. We also slip in the registration fields into the login/register fields so
      ## the user is automatically registered after logging in / registering
      <script type="text/javascript">
      (function() {
        $(".register").click(function() {
          if ($(".login_form .enroll_fieldset").length === 0) {
            $(".login_form").append( $(".enroll_fieldset").first().clone() );
          }
          if ($(".register_form .enroll_fieldset").length === 0) {
            $(".register_form").append( $(".enroll_fieldset").first().clone() );
          }
        });
      })(this)
      </script>
    %endif
  %endif

  <script src="${static.url('js/course_info.js')}"></script>
</%block>


<%block name="title"><title>About ${course.number}</title></%block>

<section class="course-info">
  <header class="course-profile">
    <div class="intro-inner-wrapper">
        <div class="main-cta">
        %if user.is_authenticated():
            %if registered:
	              %if show_courseware_link:
                    <a href="${course_target}">
                %endif
                <span class="register disabled">You are registered for this course (${course.number})</span>
                %if show_courseware_link:
                    <strong>View Courseware</strong>
                    </a>
                %endif
            %else:
               <a href="#" class="register">Register for ${course.number}</a>
	             <div id="register_message"></div>
            %endif
        %else:
            <a href="/login" class="register">Register for ${course.number}</a>
        %endif
        </div>

  </header>
</section>

%if not registered:
  <div style="display: none;">
    <form id="class_enroll_form" method="post" data-remote="true" action="${reverse('change_enrollment')}">
      <fieldset class="enroll_fieldset">
        <input name="course_id" type="hidden" value="${course.id}">
        <input name="enrollment_action" type="hidden" value="enroll">
      </fieldset>
      <div class="submit">
        <input name="submit" type="submit" value="enroll">
      </div>
    </form>
  </div>
%endif

