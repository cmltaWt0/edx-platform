<%inherit file="main.html" />
<script>
var page=${ page };

$(document).ready(function(){
   $("#booknav").treeview({collapsed:true, unique:true/*, cookieId: "treeview-book-nav", persist: "cookie"*/});
});

function goto_page(n) {
  log_event("book", {"type":"gotopage","old":page,"new":n});
  page=n;
  var prefix = "";
  if(n<100) {
    prefix="0";
  }
  if(n<10) {
    prefix="00";
  }
  $("#bookpage").attr("src","${ settings.BOOK_URL }p"+prefix+n+".png");
};

function prev_page() {
  var newpage=page-1;
  if(newpage<0) newpage=0;
  goto_page(newpage);
  log_event("book", {"type":"prevpage","new":page});
}

function next_page() {
  var newpage=page+1;
  if(newpage>1008) newpage=1008;
  goto_page(newpage);
  log_event("book", {"type":"nextpage","new":page});
}
</script>

<%include file="navigation.html" args="active_page='book'" />

<section class="main-content">
  <div class="book-wrapper">
    <ul id="booknav" class="treeview-booknav">
      <%include file="book_toc.html" />
    </ul>

    <section class="book">

      <section class="page">
        <nav>
          <ul>
            <li class="last">
              <a href="javascript:prev_page()">Previous page</a>
            </li>
            <li class="next">
              <a href="javascript:next_page()">Next page</a>
            </li>
          </ul>
        </nav>

        <img id="bookpage" src="${ settings.BOOK_URL }p${ "%03i"%(page) }.png">
      </section>
    </section>
  </div>
</section>
