<%inherit file="base.html" />
<%block name="title">Course Checklists</%block>
<%block name="bodyclass">is-signedin course checklists</%block>

<%block name="content">
<div class="wrapper-mast wrapper">
  <header class="mast has-actions has-subtitle">
    <div class="title">
      <span class="title-sub">Tools</span>
      <h1 class="title-1">Course Tasks &amp; Checklists</h1>
    </div>
  </header>
</div>

<div class="wrapper-content wrapper">
  <section class="content">
    <div class="introduction">
      <p class="copy">Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem nec elit. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
    </div>

    <article class="content-primary" role="main">
      <form id="course-checklists" class="course-checklists" method="post" action="">
        <h2 class="title title-3 sr">Current Checklists</h2>


        % for checklist in checklists:
        <section class="course-checklist" id=${'course-checklist' + str(loop.index)}>
          <span class="viz viz-checklist-status"><span class="viz value viz-checklist-status-value"><span class="int">0</span>% of checklist completed</span></span>
          <header>
            <h3 class="checklist-title title-2" title="Collapse/Expand this Checklist">
              <i class="ss-icon ss-symbolicons-standard icon-arrow ui-toggle-expansion">&#x25BE;</i>

              <i class="ss-icon ss-symbolicons-standard icon-confirm">&#x2713;</i>${checklist['short_description']}</h3>
              
              <span class="checklist-status status">Tasks Completed: <span class="status-count">0</span>/<span class="status-amount">4</span></span>
          </header>
        
          <ul class="list list-tasks">
          
            % for item in checklist['items']:
            <li class="task">
              <label for=${'course-checklist' + str(loop.parent.index) + '-task' + str(loop.index)}>
                <input type="checkbox" class="task-input" name=${'course-checklist' + str(loop.parent.index) + '-task' + str(loop.index)}
                 id=${'course-checklist' + str(loop.parent.index) + '-task' + str(loop.index)}
                 value=${item['is_checked']}>

                <div class="task-details">
                  <h4 class="task-name title title-3">${item['short_description']}</h4>
                  <p class="task-description">${item['long_description']}</p>
                </div>
              </label>

              % if item['action_text'] is not '' and item['action_url'] is not '':
              <ul class="list-actions task-actions">
                <li>
                  <a href=${item['action_url']} class="action action-primary">${item['action_text']}</a>
                </li>
              </ul>
              % endif
            </li>
            % endfor

          </ul>
        </section>
        % endfor
      </form>
    </article>

    <aside class="content-supplementary" role="complimentary">
      <div class="bit">
        <h3 class="title title-3">What are Checklists?</h3>
        <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium.</p>
      </div>

      <div class="bit">
        <h3 class="title title-3">Studio Checklists</h3>
        <nav class="nav-page checklists-current">
          <ol>
            % for checklist in checklists:
            <li class="nav-item">
              <a href="${'#course-checklist' + str(loop.index)}">${checklist['short_description']}</a>
            </li>
            % endfor
          </ol>
        </nav>
      </div>
    </aside>
  </section>
</div>
</%block>

<%block name="view_alerts">
<!-- alert: save confirmed with close -->
<div class="wrapper wrapper-alert wrapper-alert-confirmation">
  <div class="alert confirmation">
    <i class="ss-icon ss-symbolicons-standard icon icon-confirmation">&#x2713;</i>

    <div class="copy">
      <h2 class="title title-3">Your policy changes have been saved.</h2>
      <p>Please note that validation of your policy key and value pairs is not currently in place yet. If you are having difficulties, please review your policy pairs.</p>
    </div>

    <a href="#" rel="view" class="action action-alert-close">
      <i class="ss-icon ss-symbolicons-block icon icon-close">&#x2421;</i>
      <span class="label">close alert</span>
    </a>
  </div>
</div>
</%block>

<%block name="jsextra">
<script type="text/javascript">
    // checklists - prototype/basic js
    $(document).ready(function() {

      $('.course-checklist .checklist-title').each(function(e){
        $(this).addClass('is-selectable').bind('click', toggleChecklist);
      });

      $('.course-checklist .task label').each(function(e){
        $(this).bind('click', toggleTask);
      });

      // demo/proof of concept for visual progress
      $('.demo-checklistviz').click(function(e){
          (e).preventDefault();
          $('#course-checklist1 .viz-checklist-status .viz-checklist-status-value').css('width','25%');
      });

      function toggleChecklist(e) {
          (e).preventDefault();
          $(this).closest('.course-checklist').toggleClass('is-collapsed');
      }

      function toggleTask(e) {
          (e).preventDefault();

          var $taskInput = $(this).find('.task-input');

          if ($taskInput.attr('checked')) {
              $taskInput.removeAttr('checked');
              console.log('removing check');
          }
          else {
              $taskInput.attr('checked', 'checked');
              console.log('adding check');
          }

          $(this).closest('.task').toggleClass('is-completed');
      }

      // in-progress update checklist progress (based on checkbox check/uncheck events)
      function updateChecklistProgress() {
          var $statusCount = $(this).closest('.course-checklist').find('.status-count');
          var $statusAmount = $(this).closest('.course-checklist').find('.status-amount');

          if ($(this).attr('checked')) {
              console.log('adding');
          }

          else {
              console.log('subtracting');
          }
      }
    });
</script>
</%block>